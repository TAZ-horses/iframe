
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Interactive Team Mindmap</title>
  <style>
    body { margin: 0; font-family: sans-serif; background: #2D3047; overflow: hidden; }
    .node {
      position: absolute; background: white; color: black;
      padding: 10px 15px; border-radius: 6px; box-shadow: 0 4px 8px rgba(0,0,0,0.3);
      user-select: none; min-width: 160px; text-align: center; z-index: 1;
    }
    .category { background: #444; color: white; font-weight: bold; }
    .credentials { margin-top: 8px; }
    input.credential {
      width: 90%; padding: 3px; border: 1px solid #ccc;
      font-size: 0.8em; margin-bottom: 4px;
    }
    .controls {
      position: fixed; top: 10px; left: 10px; background: white;
      color: black; padding: 10px; border-radius: 6px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2); z-index: 1000;
    }
    .controls button { margin: 5px; padding: 5px 10px; }
    svg {
      position: absolute; width: 100%; height: 100%;
      pointer-events: none; z-index: 0;
    }
  </style>
</head>
<body>
<div class="controls">
  <button onclick="addCategory()">+ Add Category</button>
  <button onclick="addService()">+ Add Service</button>
  <button onclick="resetData()">â†º Reset</button>
</div>
<svg id="lines"></svg>
<div id="mindmap"></div>

<script>
let data = JSON.parse(localStorage.getItem("mindmapData") || "{}");
let positions = JSON.parse(localStorage.getItem("mindmapPositions") || "{}");
let credentials = JSON.parse(localStorage.getItem("mindmapCredentials") || "{}");
const mindmap = document.getElementById("mindmap");
const lines = document.getElementById("lines");

function saveAll() {
  localStorage.setItem("mindmapData", JSON.stringify(data));
  localStorage.setItem("mindmapPositions", JSON.stringify(positions));
  localStorage.setItem("mindmapCredentials", JSON.stringify(credentials));
}
function resetData() {
  if (confirm("Clear all data?")) {
    localStorage.clear(); location.reload();
  }
}
function createNode(text, isCategory = false, parentName = null) {
  const el = document.createElement("div");
  el.className = "node" + (isCategory ? " category" : "");
  el.textContent = text;
  if (!isCategory) {
    const credContainer = document.createElement("div");
    credContainer.className = "credentials";
    const userInput = document.createElement("input");
    userInput.className = "credential"; userInput.placeholder = "Username";
    userInput.value = credentials[text]?.username || "";
    userInput.oninput = () => {
      credentials[text] = credentials[text] || {};
      credentials[text].username = userInput.value; saveAll();
    };
    const passInput = document.createElement("input");
    passInput.className = "credential"; passInput.placeholder = "Password";
    passInput.value = credentials[text]?.password || "";
    passInput.oninput = () => {
      credentials[text] = credentials[text] || {};
      credentials[text].password = passInput.value; saveAll();
    };
    credContainer.appendChild(userInput);
    credContainer.appendChild(passInput);
    el.appendChild(credContainer);
  }
  let x = positions[text]?.x || Math.random() * 500;
  let y = positions[text]?.y || Math.random() * 300;
  el.style.left = x + "px"; el.style.top = y + "px";
  el.onmousedown = (e) => {
    if (e.target.tagName === "INPUT") return;
    const shiftX = e.clientX - el.offsetLeft;
    const shiftY = e.clientY - el.offsetTop;
    el.style.zIndex = 1000;
    function moveAt(pageX, pageY) {
      el.style.left = pageX - shiftX + 'px';
      el.style.top = pageY - shiftY + 'px';
      positions[text] = {
        x: parseFloat(el.style.left),
        y: parseFloat(el.style.top)
      };
      saveAll(); drawLines();
    }
    function onMouseMove(e) { moveAt(e.pageX, e.pageY); }
    document.addEventListener('mousemove', onMouseMove);
    document.onmouseup = () => {
      document.removeEventListener('mousemove', onMouseMove);
      el.onmouseup = null; el.style.zIndex = 1;
    };
  };
  el.ondblclick = () => {
    const newName = prompt("Edit name:", text);
    if (newName && newName !== text) {
      credentials[newName] = credentials[text];
      delete credentials[text];
      positions[newName] = positions[text];
      delete positions[text];
      if (isCategory) {
        data[newName] = data[text] || [];
        delete data[text];
      } else {
        const index = data[parentName].indexOf(text);
        if (index !== -1) data[parentName][index] = newName;
      }
      saveAll(); location.reload();
    }
  };
  el.id = text;
  mindmap.appendChild(el);
  return el;
}
function drawLines() {
  lines.innerHTML = "";
  Object.keys(data).forEach(cat => {
    const from = document.getElementById(cat)?.getBoundingClientRect();
    data[cat].forEach(service => {
      const to = document.getElementById(service)?.getBoundingClientRect();
      if (!from || !to) return;
      const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
      line.setAttribute("x1", from.left + from.width / 2);
      line.setAttribute("y1", from.top + from.height / 2);
      line.setAttribute("x2", to.left + to.width / 2);
      line.setAttribute("y2", to.top + to.height / 2);
      line.setAttribute("stroke", "#999");
      line.setAttribute("stroke-width", "2");
      lines.appendChild(line);
    });
  });
}
function addCategory() {
  const name = prompt("New category name:");
  if (!name || data[name]) return;
  data[name] = []; saveAll(); location.reload();
}
function addService() {
  const cats = Object.keys(data);
  if (!cats.length) return alert("Add a category first.");
  const service = prompt("Service name:");
const cat = prompt("Under which category?\n" + cats.join(", "));  if (!service || !data[cat]) return;
  data[cat].push(service); saveAll(); location.reload();
}
function init() {
  Object.entries(data).forEach(([cat, services]) => {
    const catNode = createNode(cat, true);
    services.forEach(service => createNode(service, false, cat));
  });
  drawLines();
}
init();
</script>
</body>
</html>
