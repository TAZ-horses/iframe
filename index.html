<script>
fetch('mindmap_data_synced.json')
  .then(res => res.json())
  .then(data => {
    const container = document.getElementById('mindmapContainer');

    const categories = Object.keys(data).sort();
    categories.forEach(cat => {
      const catDiv = document.createElement('div');
      catDiv.className = 'category';
      catDiv.textContent = cat;
      catDiv.onclick = () => {
        const next = catDiv.nextElementSibling;
        next.classList.toggle('hidden');
      };

      const serviceList = document.createElement('div');

      data[cat].forEach(service => {
        const entry = document.createElement('div');
        entry.className = 'service-entry';

        const serviceName = `<strong>${service.service}</strong>`;
        const username = `
          <div class="credentials">
            <span>Username:</span> ${service.username || '-'}
            <button class="copy-btn" onclick="navigator.clipboard.writeText('${service.username || ''}')">Copy</button>
          </div>`;

        const passwordMasked = `
          <div class="credentials">
            <span>Password:</span>
            <input type="password" value="${service.password || ''}" readonly>
            <button class="copy-btn" onclick="this.previousElementSibling.type = this.previousElementSibling.type === 'password' ? 'text' : 'password'">üëÅ</button>
            <button class="copy-btn" onclick="navigator.clipboard.writeText('${service.password || ''}')">Copy</button>
          </div>`;

        const description = `
          <div class="description">
            <strong>Description:</strong> ${service.description || '(No description provided)'}
          </div>`;

        const notes = `
          <div class="description">
            <strong>Notes:</strong> ${service.notes || '(No notes provided)'}
          </div>`;

        entry.innerHTML = serviceName + username + passwordMasked + description + notes;
        serviceList.appendChild(entry);
      });

      serviceList.className = 'hidden';
      container.appendChild(catDiv);
      container.appendChild(serviceList);
    });

    // Search bar logic
    document.getElementById('searchBar').addEventListener('input', e => {
      const term = e.target.value.toLowerCase();
      document.querySelectorAll('.service-entry').forEach(entry => {
        entry.style.display = entry.textContent.toLowerCase().includes(term) ? 'block' : 'none';
      });
    });
  });
</script>
