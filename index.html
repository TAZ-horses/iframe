<script>
fetch('mindmap_data_synced.json')
  .then(res => res.json())
  .then(data => {
    const container = document.getElementById('mindmapContainer');

    Object.keys(data).sort().forEach(cat => {
      const catDiv = document.createElement('div');
      catDiv.className = 'category';
      catDiv.textContent = cat;
      catDiv.onclick = () => {
        const next = catDiv.nextElementSibling;
        next.classList.toggle('hidden');
      };

      const serviceList = document.createElement('div');
      serviceList.className = 'hidden';

      data[cat].forEach(service => {
        const entry = document.createElement('div');
        entry.className = 'service-entry';

        entry.innerHTML = `
          <strong>${service.service}</strong>
          <div class="credentials">
            <span>Username:</span> ${service.username || '-'}
            <button class="copy-btn" onclick="navigator.clipboard.writeText('${service.username || ''}')">Copy</button>
          </div>
          <div class="credentials">
            <span>Password:</span>
            <input type="password" value="${service.password || ''}" readonly>
            <button class="copy-btn" onclick="this.previousElementSibling.type = this.previousElementSibling.type === 'password' ? 'text' : 'password'">üëÅ</button>
            <button class="copy-btn" onclick="navigator.clipboard.writeText('${service.password || ''}')">Copy</button>
          </div>
          <div class="description"><strong>Description:</strong> ${service.description || '(No description provided)'}</div>
          <div class="description"><strong>Notes:</strong> ${service.notes || '(No notes provided)'}</div>
        `;
        serviceList.appendChild(entry);
      });

      container.appendChild(catDiv);
      container.appendChild(serviceList);
    });

    document.getElementById('searchBar').addEventListener('input', e => {
      const term = e.target.value.toLowerCase();
      document.querySelectorAll('.service-entry').forEach(entry => {
        entry.style.display = entry.textContent.toLowerCase().includes(term) ? 'block' : 'none';
      });
    });
  });
</script>
